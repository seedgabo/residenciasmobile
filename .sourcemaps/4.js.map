{"version":3,"sources":["../../src/pages/zone-reservation/zone-reservation.module.ts","../../src/pages/zone-reservation/zone-reservation.ts"],"names":[],"mappings":"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","file":"4.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ZoneReservationPage } from './zone-reservation';\nimport { PipesModule } from '../../pipes/pipes.module';\n@NgModule({\n  declarations: [ZoneReservationPage],\n  imports: [\n    IonicPageModule.forChild(ZoneReservationPage),\n    PipesModule\n  ],\n})\nexport class ZoneReservationPageModule { }\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/zone-reservation/zone-reservation.module.ts","import { Api } from './../../providers/api';\nimport { Component } from '@angular/core';\nimport { NavController, NavParams, AlertController } from 'ionic-angular';\nimport moment from 'moment';\nimport {IonicPage} from \"ionic-angular\";\n\n@IonicPage()\n@Component({\n  selector: 'page-zone-reservation',\n  templateUrl: 'zone-reservation.html',\n})\nexport class ZoneReservationPage {\n  zone;\n  date;\n  options = []\n  collection = {}\n  reservations = [];\n  loading = true\n  constructor(public navCtrl: NavController, public navParams: NavParams, public api: Api, public alert: AlertController) {\n    this.zone = navParams.get('zone')\n    this.date = navParams.get('date')\n  }\n\n  ionViewDidLoad() {\n    this.loading = true\n    console.log(this.zone);\n    this.buildList();\n    this.getReservations()\n  }\n\n  buildList() {\n    this.options = [];\n    var time = moment(this.zone.start, \"HH:mm\");\n    var end = moment(this.zone.end, \"HH:mm\");\n\n    if (this.zone.start == null)\n      time = moment().startOf('day')\n    if (this.zone.end == null)\n      end = moment().startOf('day').add(23, 'hours')\n\n    console.log(time, end)\n\n    if (time < end && this.zone.interval > 0)\n      do {\n        var ref = {\n          available: this.zone.limit_user == 0 ? Number.MAX_SAFE_INTEGER : this.zone.limit_user,\n          limit_user: this.zone.limit_user,\n          time: time.clone(),\n          ref: time.clone().format(\"HH:mm\")\n        }\n        this.options[this.options.length] = ref\n        this.collection[\"\" + time.clone().format(\"HH:mm\")] = ref\n        time = time.add(this.zone.interval, 'm')\n      } while (time <= end)\n  }\n\n  getReservations() {\n    this.api.get(`reservations?where[zone_id]=${this.zone.id}&whereDateBetween[start]=${this.date.format(\"YYYY-MM-DD\")},${this.date.clone().add(1, 'd').format(\"YYYY-MM-DD\")}`)\n      .then((data: any) => {\n        this.reservations = data;\n        console.log(data);\n        data.forEach(reservation => {\n          var ref = moment.utc(reservation.start).format(\"HH:mm\")\n          console.log(this.collection[ref])\n          this.collection[ref].available -= reservation.quotas;\n          if (reservation.user_id === this.api.user.id) {\n            this.collection[ref].reserved = true\n            this.collection[ref].reservation = reservation\n          }\n        });\n        this.loading = false\n      })\n      .catch(console.error)\n  }\n\n  reservate(interval) {\n    if (interval.reserved) {\n      return this.viewReservation(interval)\n    }\n    var alert = this.alert.create({\n      title: this.api.trans('literals.reservation') + \" \" + this.zone.name,\n      message: this.api.trans(\"__.elija la cantidad de personas\"),\n      inputs: [\n        {\n          max: parseInt(interval.available),\n          min: 1,\n          value: \"1\",\n          type: \"number\",\n          label: this.api.trans(\"literals.quotas\"),\n          placeholder: this.api.trans(\"literals.quotas\"),\n          name: \"quotas\"\n        }\n      ],\n      buttons: [\n        {\n          text: this.api.trans('crud.cancel'),\n          role: \"cancel\"\n        },\n        {\n          cssClass: \"secondary\",\n          text: this.api.trans('literals.reservate'),\n          handler: (data) => {\n            if (data.quotas > 0)\n              this.postReservation(interval, data.quotas)\n          }\n        },\n      ]\n    })\n    alert.present()\n  }\n\n  viewReservation(interval) {\n    var alert = this.alert.create({\n      title: this.api.trans('literals.reservation') + \" \" + this.zone.name,\n      subTitle: this.api.trans('literals.quotas') + \": \" + interval.reservation.quotas,\n      message: this.api.trans('literals.user') + \": \" + this.api.user.name,\n      buttons: [\n        {\n          text: \"OK\"\n        },\n        {\n          text: this.api.trans(\"crud.cancel\") + \" \" + this.api.trans(\"literals.reservation\"),\n          role: \"destructive\",\n          handler: () => {\n            this.alert.create({ message: \"no disponible aun\" }).present()\n          }\n\n        }\n      ]\n    })\n    alert.present();\n  }\n\n  postReservation(interval, quotas) {\n    this.api.post('reservations',\n      {\n        quotas: quotas,\n        zone_id: this.zone.id,\n        user_id: this.api.user.id,\n        start: this.date.format(\"YYYY-MM-DD\") + \" \" + interval.time.format(\"HH:mm\"),\n        end: this.date.format(\"YYYY-MM-DD\") + \" \" + interval.time.clone().add(this.zone.interval, \"m\").format(\"HH:mm\")\n      })\n      .then((data) => {\n        console.log(data);\n        this.ionViewDidLoad();\n      })\n      .catch(console.error)\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/zone-reservation/zone-reservation.ts"],"sourceRoot":""}